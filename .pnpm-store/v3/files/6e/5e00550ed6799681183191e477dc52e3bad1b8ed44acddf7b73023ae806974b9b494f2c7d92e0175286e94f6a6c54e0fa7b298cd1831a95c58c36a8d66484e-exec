var j=Object.defineProperty;var i=(t,a)=>j(t,"name",{value:a,configurable:!0});import{isMainThread as b}from"node:worker_threads";import{i as g,a as v,e as M,m as I}from"../node-features-_8ZFwP_x.mjs";import{r as A}from"../register-Cehy_bZS.mjs";import"../get-pipe-path-BHW2eJdv.mjs";import"node:module";import P from"node:path";import{fileURLToPath as y,pathToFileURL as k}from"node:url";import"get-tsconfig";import R from"node:fs";import"esbuild";import"node:crypto";import{i as D,a as W,t as C,b as $,r as B}from"../index-DeKCL_WS.mjs";import{p as U}from"../client-BQVF1NaW.mjs";import{l as E,t as h,b as q,f as T,d as _,e as N,g as G,h as J,j as H,m as X,k as Q,i as x}from"../register-DGGDIH95.mjs";import"../require-BUZ50x2o.mjs";import{readFile as z}from"node:fs/promises";import"module";import"../temporary-directory-CwHp0_NW.mjs";import"node:os";import"node:net";const m={active:!0},K=i(async t=>{if(!t)throw new Error(`tsx must be loaded with --import instead of --loader
The --loader flag was deprecated in Node v20.6.0 and v18.19.0`);m.namespace=t.namespace,t.tsconfig!==!1&&E(t.tsconfig??process.env.TSX_TSCONFIG_PATH),t.port&&(m.port=t.port,t.port.on("message",a=>{a==="deactivate"&&(m.active=!1,t.port.postMessage({type:"deactivated"}))}))},"initialize"),V=i(()=>(E(process.env.TSX_TSCONFIG_PATH),"process.setSourceMapsEnabled(true);"),"globalPreload"),f=new Map,Y=i(async t=>{if(f.has(t))return f.get(t);if(!await R.promises.access(t).then(()=>!0,()=>!1)){f.set(t,void 0);return}const o=await R.promises.readFile(t,"utf8");try{const r=JSON.parse(o);return f.set(t,r),r}catch{throw new Error(`Error parsing: ${t}`)}},"readPackageJson"),Z=i(async t=>{let a=new URL("package.json",t);for(;!a.pathname.endsWith("/node_modules/package.json");){const o=y(a),r=await Y(o);if(r)return r;const e=a;if(a=new URL("../package.json",a),a.pathname===e.pathname)break}},"findPackageJson"),tt=i(async t=>(await Z(t))?.type??"commonjs","getPackageType"),at=i(t=>{[t]=t.split("?");const a=P.extname(t);if(a===".mts")return"module";if(a===".cts")return"commonjs"},"getFormatFromExtension"),et=i(t=>{const a=at(t);if(a)return a;if(h.test(t))return tt(t)},"getFormatFromFileUrl"),d="tsx-namespace=",l=i(t=>{const a=t.indexOf(d);if(a===-1)return;const o=t[a-1];if(o!=="?"&&o!=="&")return;const r=a+d.length,e=t.indexOf("&",r);return e===-1?t.slice(r):t.slice(r,e)},"getNamespace"),w=g(v)?"importAttributes":"importAssertions",st=i(async(t,a,o)=>{if(!m.active)return o(t,a);const r=l(t);if(m.namespace&&m.namespace!==r)return o(t,a);if(m.port){const s=new URL(t);s.searchParams.delete("tsx-namespace"),m.port.postMessage({type:"load",url:s.toString()})}U.send&&U.send({type:"dependency",path:t}),q.test(t)&&(a[w]||(a[w]={}),a[w].type="json");const e=await o(t,a),n=t.startsWith(T)?y(t):t;if(e.format==="commonjs"&&g(M)&&e.responseURL?.startsWith("file:")&&!n.endsWith(".cjs")){const s=await z(new URL(t),"utf8");if(!n.endsWith(".js")||D(s)){const p=W(s,n,{tsconfigRaw:N?.(n)}),L=r?`${n}?namespace=${encodeURIComponent(r)}`:n;return e.responseURL=`data:text/javascript,${encodeURIComponent(p.code)}?filePath=${encodeURIComponent(L)}`,e}}if(!e.source)return e;const c=e.source.toString();if(e.format==="json"||h.test(t)){const s=await C(c,n,{tsconfigRaw:N?.(n)});return{format:"module",source:_(s)}}if(e.format==="module"){const s=$(n,c);s&&(e.source=_(s))}return e},"load"),S=i(t=>{if(t.url)return t.url;const a=t.message.match(/^Cannot find module '([^']+)'/);if(a){const[,r]=a;return r}const o=t.message.match(/^Cannot find package '([^']+)'/);if(o){const[,r]=o,e=k(r);e.pathname.endsWith("/package.json")||(e.pathname+="/package.json");const n=B(e);if(n?.main)return new URL(n.main,e).toString()}},"getMissingPathFromNotFound"),u=i(async(t,a,o,r)=>{const e=X(t,!0);if(!e)return;let n;for(const c of e)try{return await o(c,a)}catch(s){const{code:p}=s;if(p!=="ERR_MODULE_NOT_FOUND"&&p!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw s;n=s}if(r)throw n},"resolveExtensions"),rt=i(async(t,a,o)=>{if(!x.test(t)&&(h.test(a.parentURL)||Q)){const e=await u(t,a,o);if(e)return e}try{return await o(t,a)}catch(e){if(e instanceof Error){const n=e;if(n.code==="ERR_MODULE_NOT_FOUND"){const c=S(n);if(c){const s=await u(c,a,o);if(s)return s}}}throw e}},"resolveBase"),F=i(async(t,a,o)=>{if(H.test(t))return await u(`${t}index`,a,o,!0);try{return await rt(t,a,o)}catch(r){if(r instanceof Error){const e=r;if(e.code==="ERR_UNSUPPORTED_DIR_IMPORT"){const n=S(e);if(n)try{return await u(`${n}/index`,a,o,!0)}catch(c){const s=c,{message:p}=s;throw s.message=s.message.replace(`${"/index".replace("/",P.sep)}'`,"'"),s.stack=s.stack.replace(p,s.message),s}}}throw r}},"resolveDirectory"),ot=i(async(t,a,o)=>{if(!G(t)&&J&&!a.parentURL?.includes("/node_modules/")){const r=J(t);for(const e of r)try{return await F(k(e).toString(),a,o)}catch{}}return F(t,a,o)},"resolveTsPaths"),O="tsx://",nt=i(async(t,a,o)=>{if(!m.active||t.startsWith("node:"))return o(t,a);let r=l(t)??(a.parentURL&&l(a.parentURL));if(m.namespace){let s;if(t.startsWith(O)){try{s=JSON.parse(t.slice(O.length))}catch{}s?.namespace&&(r=s.namespace)}if(m.namespace!==r)return o(t,a);s&&(t=s.specifier,a.parentURL=s.parentURL)}const[e,n]=t.split("?"),c=await ot(e,a,o);return c.format==="builtin"||(!c.format&&c.url.startsWith(T)&&(c.format=await et(c.url)),n&&(c.url+=`?${n}`),r&&!c.url.includes(d)&&(c.url+=(c.url.includes("?")?"&":"?")+d+r)),c},"resolve");g(I)&&b&&A();export{V as globalPreload,K as initialize,st as load,nt as resolve};
