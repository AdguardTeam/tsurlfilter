{"version":3,"file":"requireReturns.js","names":["canSkip","utils","hasATag","avoidDocs","iterateJsdoc","report","context","forceRequireReturn","forceReturnsWithAsync","options","tagName","getPreferredTagName","tags","getTags","length","iteratingFunction","isIteratingFunction","tag","missingReturnTag","shouldReport","isVirtualFunction","isAsync","hasTag","hasValueOrExecutorHasNonEmptyResolveValue","contextDefaults","meta","docs","description","url","schema","additionalProperties","properties","checkConstructors","default","type","checkGetters","contexts","items","anyOf","comment","exemptedBy"],"sources":["../../src/rules/requireReturns.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc';\n\n/**\n * We can skip checking for a return value, in case the documentation is inherited\n * or the method is either a constructor or an abstract method.\n *\n * In either of these cases the return value is optional or not defined.\n *\n * @param {*} utils\n *   a reference to the utils which are used to probe if a tag is present or not.\n * @returns {boolean}\n *   true in case deep checking can be skipped; otherwise false.\n */\nconst canSkip = (utils) => {\n  return utils.hasATag([\n    // inheritdoc implies that all documentation is inherited\n    // see https://jsdoc.app/tags-inheritdoc.html\n    //\n    // Abstract methods are by definition incomplete,\n    // so it is not an error if it declares a return value but does not implement it.\n    'abstract',\n    'virtual',\n\n    // Constructors do not have a return value by definition (https://jsdoc.app/tags-class.html)\n    // So we can bail out here, too.\n    'class',\n    'constructor',\n\n    // Return type is specified by type in @type\n    'type',\n\n    // This seems to imply a class as well\n    'interface',\n  ]) ||\n    utils.avoidDocs();\n};\n\nexport default iterateJsdoc(({\n  report,\n  utils,\n  context,\n}) => {\n  const {\n    forceRequireReturn = false,\n    forceReturnsWithAsync = false,\n  } = context.options[0] || {};\n\n  // A preflight check. We do not need to run a deep check\n  // in case the @returns comment is optional or undefined.\n  if (canSkip(utils)) {\n    return;\n  }\n\n  const tagName = utils.getPreferredTagName({\n    tagName: 'returns',\n  });\n  if (!tagName) {\n    return;\n  }\n\n  const tags = utils.getTags(tagName);\n\n  if (tags.length > 1) {\n    report(`Found more than one @${tagName} declaration.`);\n  }\n\n  const iteratingFunction = utils.isIteratingFunction();\n\n  // In case the code returns something, we expect a return value in JSDoc.\n  const [\n    tag,\n  ] = tags;\n  const missingReturnTag = typeof tag === 'undefined' || tag === null;\n\n  const shouldReport = () => {\n    if (!missingReturnTag) {\n      return false;\n    }\n\n    if (forceRequireReturn && (\n      iteratingFunction || utils.isVirtualFunction()\n    )) {\n      return true;\n    }\n\n    const isAsync = !iteratingFunction && utils.hasTag('async') ||\n      iteratingFunction && utils.isAsync();\n\n    if (forceReturnsWithAsync && isAsync) {\n      return true;\n    }\n\n    return !isAsync && iteratingFunction && utils.hasValueOrExecutorHasNonEmptyResolveValue(\n      forceReturnsWithAsync,\n    );\n  };\n\n  if (shouldReport()) {\n    report(`Missing JSDoc @${tagName} declaration.`);\n  }\n}, {\n  contextDefaults: true,\n  meta: {\n    docs: {\n      description: 'Requires that returns are documented.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-require-returns',\n    },\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          checkConstructors: {\n            default: false,\n            type: 'boolean',\n          },\n          checkGetters: {\n            default: true,\n            type: 'boolean',\n          },\n          contexts: {\n            items: {\n              anyOf: [\n                {\n                  type: 'string',\n                },\n                {\n                  additionalProperties: false,\n                  properties: {\n                    comment: {\n                      type: 'string',\n                    },\n                    context: {\n                      type: 'string',\n                    },\n                  },\n                  type: 'object',\n                },\n              ],\n            },\n            type: 'array',\n          },\n          exemptedBy: {\n            items: {\n              type: 'string',\n            },\n            type: 'array',\n          },\n          forceRequireReturn: {\n            default: false,\n            type: 'boolean',\n          },\n          forceReturnsWithAsync: {\n            default: false,\n            type: 'boolean',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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"}