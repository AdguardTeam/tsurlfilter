{"version":3,"file":"requireYieldsCheck.js","names":["canSkip","utils","settings","voidingTags","mode","push","hasATag","isConstructor","classHasTag","checkTagName","report","tagName","preferredTagName","getPreferredTagName","tags","getTags","length","iterateJsdoc","context","next","checkGeneratorsOnly","options","preferredYieldTagName","yieldTag","shouldReportYields","type","trim","hasYieldValue","isGenerator","hasDefinedTypeTag","preferredNextTagName","nextTag","shouldReportNext","hasYieldReturnValue","meta","docs","description","url","schema","additionalProperties","properties","default","contexts","items","anyOf","comment","exemptedBy"],"sources":["../../src/rules/requireYieldsCheck.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc';\n\nconst canSkip = (utils, settings) => {\n  const voidingTags = [\n    // An abstract function is by definition incomplete\n    // so it is perfectly fine if a yield is documented but\n    // not present within the function.\n    // A subclass may inherit the doc and implement the\n    // missing yield.\n    'abstract',\n    'virtual',\n\n    // Constructor functions do not have a yield value\n    //  so we can bail here, too.\n    'class',\n    'constructor',\n\n    // This seems to imply a class as well\n    'interface',\n  ];\n\n  if (settings.mode === 'closure') {\n    // Structural Interface in GCC terms, equivalent to @interface tag as far as this rule is concerned\n    voidingTags.push('record');\n  }\n\n  return utils.hasATag(voidingTags) ||\n    utils.isConstructor() ||\n    utils.classHasTag('interface') ||\n    settings.mode === 'closure' && utils.classHasTag('record');\n};\n\nconst checkTagName = (utils, report, tagName) => {\n  const preferredTagName = utils.getPreferredTagName({\n    tagName,\n  });\n  if (!preferredTagName) {\n    return [];\n  }\n\n  const tags = utils.getTags(preferredTagName);\n\n  if (tags.length === 0) {\n    return [];\n  }\n\n  if (tags.length > 1) {\n    report(`Found more than one @${preferredTagName} declaration.`);\n\n    return [];\n  }\n\n  return [\n    preferredTagName, tags[0],\n  ];\n};\n\nexport default iterateJsdoc(({\n  context,\n  report,\n  settings,\n  utils,\n}) => {\n  if (canSkip(utils, settings)) {\n    return;\n  }\n\n  const {\n    next = false,\n    checkGeneratorsOnly = false,\n  } = context.options[0] || {};\n\n  const [\n    preferredYieldTagName,\n    yieldTag,\n  ] = checkTagName(\n    utils, report, 'yields',\n  );\n  if (preferredYieldTagName) {\n    const shouldReportYields = () => {\n      if (yieldTag.type.trim() === 'never') {\n        if (utils.hasYieldValue()) {\n          report(`JSDoc @${preferredYieldTagName} declaration set with \"never\" but yield expression is present in function.`);\n        }\n\n        return false;\n      }\n\n      if (checkGeneratorsOnly && !utils.isGenerator()) {\n        return true;\n      }\n\n      return utils.hasDefinedTypeTag(yieldTag) && !utils.hasYieldValue();\n    };\n\n    // In case a yield value is declared in JSDoc, we also expect one in the code.\n    if (shouldReportYields()) {\n      report(`JSDoc @${preferredYieldTagName} declaration present but yield expression not available in function.`);\n    }\n  }\n\n  if (next) {\n    const [\n      preferredNextTagName,\n      nextTag,\n    ] = checkTagName(\n      utils, report, 'next',\n    );\n    if (preferredNextTagName) {\n      const shouldReportNext = () => {\n        if (nextTag.type.trim() === 'never') {\n          if (utils.hasYieldReturnValue()) {\n            report(`JSDoc @${preferredNextTagName} declaration set with \"never\" but yield expression with return value is present in function.`);\n          }\n\n          return false;\n        }\n\n        if (checkGeneratorsOnly && !utils.isGenerator()) {\n          return true;\n        }\n\n        return utils.hasDefinedTypeTag(nextTag) && !utils.hasYieldReturnValue();\n      };\n\n      if (shouldReportNext()) {\n        report(`JSDoc @${preferredNextTagName} declaration present but yield expression with return value not available in function.`);\n      }\n    }\n  }\n}, {\n  meta: {\n    docs: {\n      description: 'Requires a yield statement in function body if a `@yields` tag is specified in jsdoc comment.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-require-yields-check',\n    },\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          checkGeneratorsOnly: {\n            default: false,\n            type: 'boolean',\n          },\n          contexts: {\n            items: {\n              anyOf: [\n                {\n                  type: 'string',\n                },\n                {\n                  additionalProperties: false,\n                  properties: {\n                    comment: {\n                      type: 'string',\n                    },\n                    context: {\n                      type: 'string',\n                    },\n                  },\n                  type: 'object',\n                },\n              ],\n            },\n            type: 'array',\n          },\n          exemptedBy: {\n            items: {\n              type: 'string',\n            },\n            type: 'array',\n          },\n          next: {\n            default: false,\n            type: 'boolean',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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"}