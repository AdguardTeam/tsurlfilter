{"version":3,"file":"matchDescription.js","names":["matchDescriptionDefault","stringOrDefault","value","userDefault","iterateJsdoc","jsdoc","report","context","utils","mainDescription","matchDescription","message","tags","options","validateDescription","desc","tag","mainDescriptionMatch","errorMessage","match","Object","prototype","hasOwnProperty","call","tagValue","tagName","regex","getRegexFromString","test","line","source","number","description","getDescription","keys","length","hasOptionTag","Boolean","forEachPreferredTag","matchingJsdocTag","targetTagName","name","getTagDescription","trim","whitelistedTags","filterTags","tagsWithNames","tagsWithoutNames","getTagsByType","some","replace","contextDefaults","meta","docs","url","schema","additionalProperties","properties","contexts","items","anyOf","type","comment","oneOf","format","patternProperties","enum"],"sources":["../../src/rules/matchDescription.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc';\n\n// If supporting Node >= 10, we could loosen the default to this for the\n//   initial letter: \\\\p{Upper}\nconst matchDescriptionDefault = '^\\n?([A-Z`\\\\d_][\\\\s\\\\S]*[.?!`]\\\\s*)?$';\n\nconst stringOrDefault = (value, userDefault) => {\n  return typeof value === 'string' ?\n    value :\n    userDefault || matchDescriptionDefault;\n};\n\nexport default iterateJsdoc(({\n  jsdoc,\n  report,\n  context,\n  utils,\n}) => {\n  const {\n    mainDescription,\n    matchDescription,\n    message,\n    tags,\n  } = context.options[0] || {};\n\n  const validateDescription = (desc, tag) => {\n    let mainDescriptionMatch = mainDescription;\n    let errorMessage = message;\n    if (typeof mainDescription === 'object') {\n      mainDescriptionMatch = mainDescription.match;\n      errorMessage = mainDescription.message;\n    }\n\n    if (mainDescriptionMatch === false && (\n      !tag || !Object.prototype.hasOwnProperty.call(tags, tag.tag))\n    ) {\n      return;\n    }\n\n    let tagValue = mainDescriptionMatch;\n    if (tag) {\n      const tagName = tag.tag;\n      if (typeof tags[tagName] === 'object') {\n        tagValue = tags[tagName].match;\n        errorMessage = tags[tagName].message;\n      } else {\n        tagValue = tags[tagName];\n      }\n    }\n\n    const regex = utils.getRegexFromString(\n      stringOrDefault(tagValue, matchDescription),\n    );\n\n    if (!regex.test(desc)) {\n      report(\n        errorMessage || 'JSDoc description does not satisfy the regex pattern.',\n        null,\n        tag || {\n          // Add one as description would typically be into block\n          line: jsdoc.source[0].number + 1,\n        },\n      );\n    }\n  };\n\n  const {\n    description,\n  } = utils.getDescription();\n  if (description) {\n    validateDescription(description);\n  }\n\n  if (!tags || !Object.keys(tags).length) {\n    return;\n  }\n\n  const hasOptionTag = (tagName) => {\n    return Boolean(tags[tagName]);\n  };\n\n  utils.forEachPreferredTag('description', (matchingJsdocTag, targetTagName) => {\n    const desc = (matchingJsdocTag.name + ' ' + utils.getTagDescription(matchingJsdocTag)).trim();\n    if (hasOptionTag(targetTagName)) {\n      validateDescription(desc, matchingJsdocTag);\n    }\n  }, true);\n\n  const whitelistedTags = utils.filterTags(({\n    tag: tagName,\n  }) => {\n    return hasOptionTag(tagName);\n  });\n  const {\n    tagsWithNames,\n    tagsWithoutNames,\n  } = utils.getTagsByType(whitelistedTags);\n\n  tagsWithNames.some((tag) => {\n    const desc = utils.getTagDescription(tag).replace(/^[- ]*/u, '')\n      .trim();\n\n    return validateDescription(desc, tag);\n  });\n\n  tagsWithoutNames.some((tag) => {\n    const desc = (tag.name + ' ' + utils.getTagDescription(tag)).trim();\n\n    return validateDescription(desc, tag);\n  });\n}, {\n  contextDefaults: true,\n  meta: {\n    docs: {\n      description: 'Enforces a regular expression pattern on descriptions.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-match-description',\n    },\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          contexts: {\n            items: {\n              anyOf: [\n                {\n                  type: 'string',\n                },\n                {\n                  additionalProperties: false,\n                  properties: {\n                    comment: {\n                      type: 'string',\n                    },\n                    context: {\n                      type: 'string',\n                    },\n                  },\n                  type: 'object',\n                },\n              ],\n            },\n            type: 'array',\n          },\n          mainDescription: {\n            oneOf: [\n              {\n                format: 'regex',\n                type: 'string',\n              },\n              {\n                type: 'boolean',\n              },\n              {\n                additionalProperties: false,\n                properties: {\n                  match: {\n                    oneOf: [\n                      {\n                        format: 'regex',\n                        type: 'string',\n                      },\n                      {\n                        type: 'boolean',\n                      },\n                    ],\n                  },\n                  message: {\n                    type: 'string',\n                  },\n                },\n                type: 'object',\n              },\n            ],\n          },\n          matchDescription: {\n            format: 'regex',\n            type: 'string',\n          },\n          message: {\n            type: 'string',\n          },\n          tags: {\n            patternProperties: {\n              '.*': {\n                oneOf: [\n                  {\n                    format: 'regex',\n                    type: 'string',\n                  },\n                  {\n                    enum: [\n                      true,\n                    ],\n                    type: 'boolean',\n                  },\n                  {\n                    additionalProperties: false,\n                    properties: {\n                      match: {\n                        oneOf: [\n                          {\n                            format: 'regex',\n                            type: 'string',\n                          },\n                          {\n                            enum: [\n                              true,\n                            ],\n                            type: 'boolean',\n                          },\n                        ],\n                      },\n                      message: {\n                        type: 'string',\n                      },\n                    },\n                    type: 'object',\n                  },\n                ],\n              },\n            },\n            type: 'object',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":";;;;;;AAAA;AAA2C;AAE3C;AACA;AACA,MAAMA,uBAAuB,GAAG,uCAAuC;AAEvE,MAAMC,eAAe,GAAG,CAACC,KAAK,EAAEC,WAAW,KAAK;EAC9C,OAAO,OAAOD,KAAK,KAAK,QAAQ,GAC9BA,KAAK,GACLC,WAAW,IAAIH,uBAAuB;AAC1C,CAAC;AAAC,eAEa,IAAAI,qBAAY,EAAC,CAAC;EAC3BC,KAAK;EACLC,MAAM;EACNC,OAAO;EACPC;AACF,CAAC,KAAK;EACJ,MAAM;IACJC,eAAe;IACfC,gBAAgB;IAChBC,OAAO;IACPC;EACF,CAAC,GAAGL,OAAO,CAACM,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;EAE5B,MAAMC,mBAAmB,GAAG,CAACC,IAAI,EAAEC,GAAG,KAAK;IACzC,IAAIC,oBAAoB,GAAGR,eAAe;IAC1C,IAAIS,YAAY,GAAGP,OAAO;IAC1B,IAAI,OAAOF,eAAe,KAAK,QAAQ,EAAE;MACvCQ,oBAAoB,GAAGR,eAAe,CAACU,KAAK;MAC5CD,YAAY,GAAGT,eAAe,CAACE,OAAO;IACxC;IAEA,IAAIM,oBAAoB,KAAK,KAAK,KAChC,CAACD,GAAG,IAAI,CAACI,MAAM,CAACC,SAAS,CAACC,cAAc,CAACC,IAAI,CAACX,IAAI,EAAEI,GAAG,CAACA,GAAG,CAAC,CAAC,EAC7D;MACA;IACF;IAEA,IAAIQ,QAAQ,GAAGP,oBAAoB;IACnC,IAAID,GAAG,EAAE;MACP,MAAMS,OAAO,GAAGT,GAAG,CAACA,GAAG;MACvB,IAAI,OAAOJ,IAAI,CAACa,OAAO,CAAC,KAAK,QAAQ,EAAE;QACrCD,QAAQ,GAAGZ,IAAI,CAACa,OAAO,CAAC,CAACN,KAAK;QAC9BD,YAAY,GAAGN,IAAI,CAACa,OAAO,CAAC,CAACd,OAAO;MACtC,CAAC,MAAM;QACLa,QAAQ,GAAGZ,IAAI,CAACa,OAAO,CAAC;MAC1B;IACF;IAEA,MAAMC,KAAK,GAAGlB,KAAK,CAACmB,kBAAkB,CACpC1B,eAAe,CAACuB,QAAQ,EAAEd,gBAAgB,CAAC,CAC5C;IAED,IAAI,CAACgB,KAAK,CAACE,IAAI,CAACb,IAAI,CAAC,EAAE;MACrBT,MAAM,CACJY,YAAY,IAAI,uDAAuD,EACvE,IAAI,EACJF,GAAG,IAAI;QACL;QACAa,IAAI,EAAExB,KAAK,CAACyB,MAAM,CAAC,CAAC,CAAC,CAACC,MAAM,GAAG;MACjC,CAAC,CACF;IACH;EACF,CAAC;EAED,MAAM;IACJC;EACF,CAAC,GAAGxB,KAAK,CAACyB,cAAc,EAAE;EAC1B,IAAID,WAAW,EAAE;IACflB,mBAAmB,CAACkB,WAAW,CAAC;EAClC;EAEA,IAAI,CAACpB,IAAI,IAAI,CAACQ,MAAM,CAACc,IAAI,CAACtB,IAAI,CAAC,CAACuB,MAAM,EAAE;IACtC;EACF;EAEA,MAAMC,YAAY,GAAIX,OAAO,IAAK;IAChC,OAAOY,OAAO,CAACzB,IAAI,CAACa,OAAO,CAAC,CAAC;EAC/B,CAAC;EAEDjB,KAAK,CAAC8B,mBAAmB,CAAC,aAAa,EAAE,CAACC,gBAAgB,EAAEC,aAAa,KAAK;IAC5E,MAAMzB,IAAI,GAAG,CAACwB,gBAAgB,CAACE,IAAI,GAAG,GAAG,GAAGjC,KAAK,CAACkC,iBAAiB,CAACH,gBAAgB,CAAC,EAAEI,IAAI,EAAE;IAC7F,IAAIP,YAAY,CAACI,aAAa,CAAC,EAAE;MAC/B1B,mBAAmB,CAACC,IAAI,EAAEwB,gBAAgB,CAAC;IAC7C;EACF,CAAC,EAAE,IAAI,CAAC;EAER,MAAMK,eAAe,GAAGpC,KAAK,CAACqC,UAAU,CAAC,CAAC;IACxC7B,GAAG,EAAES;EACP,CAAC,KAAK;IACJ,OAAOW,YAAY,CAACX,OAAO,CAAC;EAC9B,CAAC,CAAC;EACF,MAAM;IACJqB,aAAa;IACbC;EACF,CAAC,GAAGvC,KAAK,CAACwC,aAAa,CAACJ,eAAe,CAAC;EAExCE,aAAa,CAACG,IAAI,CAAEjC,GAAG,IAAK;IAC1B,MAAMD,IAAI,GAAGP,KAAK,CAACkC,iBAAiB,CAAC1B,GAAG,CAAC,CAACkC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,CAC7DP,IAAI,EAAE;IAET,OAAO7B,mBAAmB,CAACC,IAAI,EAAEC,GAAG,CAAC;EACvC,CAAC,CAAC;EAEF+B,gBAAgB,CAACE,IAAI,CAAEjC,GAAG,IAAK;IAC7B,MAAMD,IAAI,GAAG,CAACC,GAAG,CAACyB,IAAI,GAAG,GAAG,GAAGjC,KAAK,CAACkC,iBAAiB,CAAC1B,GAAG,CAAC,EAAE2B,IAAI,EAAE;IAEnE,OAAO7B,mBAAmB,CAACC,IAAI,EAAEC,GAAG,CAAC;EACvC,CAAC,CAAC;AACJ,CAAC,EAAE;EACDmC,eAAe,EAAE,IAAI;EACrBC,IAAI,EAAE;IACJC,IAAI,EAAE;MACJrB,WAAW,EAAE,wDAAwD;MACrEsB,GAAG,EAAE;IACP,CAAC;IACDC,MAAM,EAAE,CACN;MACEC,oBAAoB,EAAE,KAAK;MAC3BC,UAAU,EAAE;QACVC,QAAQ,EAAE;UACRC,KAAK,EAAE;YACLC,KAAK,EAAE,CACL;cACEC,IAAI,EAAE;YACR,CAAC,EACD;cACEL,oBAAoB,EAAE,KAAK;cAC3BC,UAAU,EAAE;gBACVK,OAAO,EAAE;kBACPD,IAAI,EAAE;gBACR,CAAC;gBACDtD,OAAO,EAAE;kBACPsD,IAAI,EAAE;gBACR;cACF,CAAC;cACDA,IAAI,EAAE;YACR,CAAC;UAEL,CAAC;UACDA,IAAI,EAAE;QACR,CAAC;QACDpD,eAAe,EAAE;UACfsD,KAAK,EAAE,CACL;YACEC,MAAM,EAAE,OAAO;YACfH,IAAI,EAAE;UACR,CAAC,EACD;YACEA,IAAI,EAAE;UACR,CAAC,EACD;YACEL,oBAAoB,EAAE,KAAK;YAC3BC,UAAU,EAAE;cACVtC,KAAK,EAAE;gBACL4C,KAAK,EAAE,CACL;kBACEC,MAAM,EAAE,OAAO;kBACfH,IAAI,EAAE;gBACR,CAAC,EACD;kBACEA,IAAI,EAAE;gBACR,CAAC;cAEL,CAAC;cACDlD,OAAO,EAAE;gBACPkD,IAAI,EAAE;cACR;YACF,CAAC;YACDA,IAAI,EAAE;UACR,CAAC;QAEL,CAAC;QACDnD,gBAAgB,EAAE;UAChBsD,MAAM,EAAE,OAAO;UACfH,IAAI,EAAE;QACR,CAAC;QACDlD,OAAO,EAAE;UACPkD,IAAI,EAAE;QACR,CAAC;QACDjD,IAAI,EAAE;UACJqD,iBAAiB,EAAE;YACjB,IAAI,EAAE;cACJF,KAAK,EAAE,CACL;gBACEC,MAAM,EAAE,OAAO;gBACfH,IAAI,EAAE;cACR,CAAC,EACD;gBACEK,IAAI,EAAE,CACJ,IAAI,CACL;gBACDL,IAAI,EAAE;cACR,CAAC,EACD;gBACEL,oBAAoB,EAAE,KAAK;gBAC3BC,UAAU,EAAE;kBACVtC,KAAK,EAAE;oBACL4C,KAAK,EAAE,CACL;sBACEC,MAAM,EAAE,OAAO;sBACfH,IAAI,EAAE;oBACR,CAAC,EACD;sBACEK,IAAI,EAAE,CACJ,IAAI,CACL;sBACDL,IAAI,EAAE;oBACR,CAAC;kBAEL,CAAC;kBACDlD,OAAO,EAAE;oBACPkD,IAAI,EAAE;kBACR;gBACF,CAAC;gBACDA,IAAI,EAAE;cACR,CAAC;YAEL;UACF,CAAC;UACDA,IAAI,EAAE;QACR;MACF,CAAC;MACDA,IAAI,EAAE;IACR,CAAC,CACF;IACDA,IAAI,EAAE;EACR;AACF,CAAC,CAAC;AAAA;AAAA"}