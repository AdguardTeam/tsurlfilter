"use strict";var E=Object.defineProperty;var u=(e,t)=>E(e,"name",{value:t,configurable:!0});var S=require("node:worker_threads"),d=require("../node-features-roYmp9jK.cjs"),F=require("../register-21veAq26.cjs");require("../get-pipe-path-BoR10qr8.cjs"),require("node:module");var k=require("node:path"),l=require("node:url");require("get-tsconfig");var R=require("node:fs");require("esbuild"),require("node:crypto");var m=require("../index-BsW12Ot9.cjs"),U=require("../client-D6NvIMSC.cjs"),c=require("../register-CCR7NebB.cjs");require("../require-h-YvXqeU.cjs");var N=require("node:fs/promises");require("module"),require("../temporary-directory-B83uKxJF.cjs"),require("node:os"),require("node:net");const p={active:!0},J=u(async e=>{if(!e)throw new Error(`tsx must be loaded with --import instead of --loader
The --loader flag was deprecated in Node v20.6.0 and v18.19.0`);p.namespace=e.namespace,e.tsconfig!==!1&&c.loadTsconfig(e.tsconfig??process.env.TSX_TSCONFIG_PATH),e.port&&(p.port=e.port,e.port.on("message",t=>{t==="deactivate"&&(p.active=!1,e.port.postMessage({type:"deactivated"}))}))},"initialize"),L=u(()=>(c.loadTsconfig(process.env.TSX_TSCONFIG_PATH),"process.setSourceMapsEnabled(true);"),"globalPreload"),h=new Map,O=u(async e=>{if(h.has(e))return h.get(e);if(!await R.promises.access(e).then(()=>!0,()=>!1)){h.set(e,void 0);return}const n=await R.promises.readFile(e,"utf8");try{const s=JSON.parse(n);return h.set(e,s),s}catch{throw new Error(`Error parsing: ${e}`)}},"readPackageJson"),M=u(async e=>{let t=new URL("package.json",e);for(;!t.pathname.endsWith("/node_modules/package.json");){const n=l.fileURLToPath(t),s=await O(n);if(s)return s;const r=t;if(t=new URL("../package.json",t),t.pathname===r.pathname)break}},"findPackageJson"),j=u(async e=>(await M(e))?.type??"commonjs","getPackageType"),b=u(e=>{[e]=e.split("?");const t=k.extname(e);if(t===".mts")return"module";if(t===".cts")return"commonjs"},"getFormatFromExtension"),I=u(e=>{const t=b(e);if(t)return t;if(c.tsExtensionsPattern.test(e))return j(e)},"getFormatFromFileUrl"),g="tsx-namespace=",w=u(e=>{const t=e.indexOf(g);if(t===-1)return;const n=e[t-1];if(n!=="?"&&n!=="&")return;const s=t+g.length,r=e.indexOf("&",s);return r===-1?e.slice(s):e.slice(s,r)},"getNamespace"),y=d.isFeatureSupported(d.importAttributes)?"importAttributes":"importAssertions",A=u(async(e,t,n)=>{if(!p.active)return n(e,t);const s=w(e);if(p.namespace&&p.namespace!==s)return n(e,t);if(p.port){const a=new URL(e);a.searchParams.delete("tsx-namespace"),p.port.postMessage({type:"load",url:a.toString()})}U.parent.send&&U.parent.send({type:"dependency",path:e}),c.isJsonPattern.test(e)&&(t[y]||(t[y]={}),t[y].type="json");const r=await n(e,t),o=e.startsWith(c.fileUrlPrefix)?l.fileURLToPath(e):e;if(r.format==="commonjs"&&d.isFeatureSupported(d.esmLoadReadFile)&&r.responseURL?.startsWith("file:")&&!o.endsWith(".cjs")){const a=await N.readFile(new URL(e),"utf8");if(!o.endsWith(".js")||m.isESM(a)){const f=m.transformSync(a,o,{tsconfigRaw:c.fileMatcher?.(o)}),v=s?`${o}?namespace=${encodeURIComponent(s)}`:o;return r.responseURL=`data:text/javascript,${encodeURIComponent(f.code)}?filePath=${encodeURIComponent(v)}`,r}}if(!r.source)return r;const i=r.source.toString();if(r.format==="json"||c.tsExtensionsPattern.test(e)){const a=await m.transform(i,o,{tsconfigRaw:c.fileMatcher?.(o)});return{format:"module",source:c.inlineSourceMap(a)}}if(r.format==="module"){const a=m.transformDynamicImport(o,i);a&&(r.source=c.inlineSourceMap(a))}return r},"load"),T=u(e=>{if(e.url)return e.url;const t=e.message.match(/^Cannot find module '([^']+)'/);if(t){const[,s]=t;return s}const n=e.message.match(/^Cannot find package '([^']+)'/);if(n){const[,s]=n,r=l.pathToFileURL(s);r.pathname.endsWith("/package.json")||(r.pathname+="/package.json");const o=m.readJsonFile(r);if(o?.main)return new URL(o.main,r).toString()}},"getMissingPathFromNotFound"),P=u(async(e,t,n,s)=>{const r=c.mapTsExtensions(e,!0);if(!r)return;let o;for(const i of r)try{return await n(i,t)}catch(a){const{code:f}=a;if(f!=="ERR_MODULE_NOT_FOUND"&&f!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw a;o=a}if(s)throw o},"resolveExtensions"),D=u(async(e,t,n)=>{if(!c.isBarePackageNamePattern.test(e)&&(c.tsExtensionsPattern.test(t.parentURL)||c.allowJs)){const r=await P(e,t,n);if(r)return r}try{return await n(e,t)}catch(r){if(r instanceof Error){const o=r;if(o.code==="ERR_MODULE_NOT_FOUND"){const i=T(o);if(i){const a=await P(i,t,n);if(a)return a}}}throw r}},"resolveBase"),_=u(async(e,t,n)=>{if(c.isDirectoryPattern.test(e))return await P(`${e}index`,t,n,!0);try{return await D(e,t,n)}catch(s){if(s instanceof Error){const r=s;if(r.code==="ERR_UNSUPPORTED_DIR_IMPORT"){const o=T(r);if(o)try{return await P(`${o}/index`,t,n,!0)}catch(i){const a=i,{message:f}=a;throw a.message=a.message.replace(`${"/index".replace("/",k.sep)}'`,"'"),a.stack=a.stack.replace(f,a.message),a}}}throw s}},"resolveDirectory"),W=u(async(e,t,n)=>{if(!c.requestAcceptsQuery(e)&&c.tsconfigPathsMatcher&&!t.parentURL?.includes("/node_modules/")){const s=c.tsconfigPathsMatcher(e);for(const r of s)try{return await _(l.pathToFileURL(r).toString(),t,n)}catch{}}return _(e,t,n)},"resolveTsPaths"),q="tsx://",$=u(async(e,t,n)=>{if(!p.active||e.startsWith("node:"))return n(e,t);let s=w(e)??(t.parentURL&&w(t.parentURL));if(p.namespace){let a;if(e.startsWith(q)){try{a=JSON.parse(e.slice(q.length))}catch{}a?.namespace&&(s=a.namespace)}if(p.namespace!==s)return n(e,t);a&&(e=a.specifier,t.parentURL=a.parentURL)}const[r,o]=e.split("?"),i=await W(r,t,n);return i.format==="builtin"||(!i.format&&i.url.startsWith(c.fileUrlPrefix)&&(i.format=await I(i.url)),o&&(i.url+=`?${o}`),s&&!i.url.includes(g)&&(i.url+=(i.url.includes("?")?"&":"?")+g+s)),i},"resolve");d.isFeatureSupported(d.moduleRegister)&&S.isMainThread&&F.register(),exports.globalPreload=L,exports.initialize=J,exports.load=A,exports.resolve=$;
