{"version":3,"file":"generateRule.js","names":["ruleName","options","process","argv","recommended","includes","console","error","test","ruleNamesPath","ruleNames","JSON","parse","fs","readFile","push","sort","writeFile","stringify","log","ruleTemplate","camelCasedRuleName","camelCase","rulePath","existsSync","ruleTestTemplate","ruleTestPath","ruleReadmeTemplate","ruleReadmePath","replaceInOrder","path","oldRegex","checkName","newLine","oldIsCamel","offsets","readme","replace","matchedLine","n1","offset","str","oldRule","oldRuleB","alreadyIncluded","itemIndex","findIndex","item","undefined","pop","length","slice","repeat","chdir","resolve","__dirname","open"],"sources":["../src/bin/generateRule.js"],"sourcesContent":["/* eslint-disable no-console -- CLI */\n\n/**\n * @example\n *\n * ```shell\n * npm run create-rule my-new-rule --recommended\n * ```\n */\n\nimport {\n  existsSync,\n} from 'fs';\nimport fs from 'fs/promises';\nimport {\n  resolve,\n} from 'path';\nimport camelCase from 'camelcase';\nimport open from 'open-editor';\n\n// Todo: Would ideally have prompts, e.g., to ask for whether type was problem/layout, etc.\n\nconst [\n  , , ruleName,\n  ...options\n] = process.argv;\n\nconst recommended = options.includes('--recommended');\n\n(async () => {\n  if (!ruleName) {\n    console.error('Please supply a rule name');\n\n    return;\n  }\n\n  if ((/[A-Z]/u).test(ruleName)) {\n    console.error('Please ensure the rule has no capital letters');\n\n    return;\n  }\n\n  const ruleNamesPath = './test/rules/ruleNames.json';\n  const ruleNames = JSON.parse(await fs.readFile(\n    ruleNamesPath, 'utf8',\n  ));\n  if (!ruleNames.includes(ruleName)) {\n    ruleNames.push(ruleName);\n    ruleNames.sort();\n  }\n\n  await fs.writeFile(ruleNamesPath, JSON.stringify(ruleNames, null, 2) + '\\n');\n  console.log('ruleNames', ruleNames);\n\n  const ruleTemplate = `import iterateJsdoc from '../iterateJsdoc';\n\nexport default iterateJsdoc(({\n  context,\n  utils,\n}) => {\n  // Rule here\n}, {\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: '',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-${ruleName}',\n    },\n    schema: [\n      {\n        additionalProperies: false,\n        properties: {\n          // Option properties here (or remove the object)\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n`;\n\n  const camelCasedRuleName = camelCase(ruleName);\n\n  const rulePath = `./src/rules/${camelCasedRuleName}.js`;\n\n  if (!existsSync(rulePath)) {\n    await fs.writeFile(rulePath, ruleTemplate);\n  }\n\n  const ruleTestTemplate = `export default {\n  invalid: [\n    {\n      code: \\`\n      \\`,\n      errors: [{\n        line: '',\n        message: '',\n      }],\n    },\n  ],\n  valid: [\n    {\n      code: \\`\n      \\`,\n    },\n  ],\n};\n`;\n\n  const ruleTestPath = `./test/rules/assertions/${camelCasedRuleName}.js`;\n  if (!existsSync(ruleTestPath)) {\n    await fs.writeFile(ruleTestPath, ruleTestTemplate);\n  }\n\n  const ruleReadmeTemplate = `### \\`${ruleName}\\`\n\n|||\n|---|---|\n|Context|everywhere|\n|Tags|\\`\\`|\n|Recommended|${recommended ? 'true' : 'false'}|\n|Settings||\n|Options||\n\n<!-- assertions ${camelCasedRuleName} -->\n`;\n\n  const ruleReadmePath = `./.README/rules/${ruleName}.md`;\n  if (!existsSync(ruleReadmePath)) {\n    await fs.writeFile(ruleReadmePath, ruleReadmeTemplate);\n  }\n\n  const replaceInOrder = async ({\n    path,\n    oldRegex,\n    checkName,\n    newLine,\n    oldIsCamel,\n  }) => {\n    const offsets = [];\n\n    let readme = await fs.readFile(path, 'utf8');\n    readme.replace(\n      oldRegex,\n      (matchedLine, n1, offset, str, {\n        oldRule,\n      }) => {\n        offsets.push({\n          matchedLine,\n          offset,\n          oldRule,\n        });\n      },\n    );\n\n    offsets.sort(({\n      oldRule,\n    }, {\n      oldRule: oldRuleB,\n    }) => {\n      // eslint-disable-next-line no-extra-parens\n      return oldRule < oldRuleB ? -1 : (oldRule > oldRuleB ? 1 : 0);\n    });\n\n    let alreadyIncluded = false;\n    const itemIndex = offsets.findIndex(({\n      oldRule,\n    }) => {\n      alreadyIncluded ||= oldIsCamel ? camelCasedRuleName === oldRule : ruleName === oldRule;\n\n      return oldIsCamel ? camelCasedRuleName < oldRule : ruleName < oldRule;\n    });\n    let item = itemIndex !== undefined && offsets[itemIndex];\n    if (item && itemIndex === 0 &&\n\n      // This property would not always be sufficient but in this case it is.\n      oldIsCamel\n    ) {\n      item.offset = 0;\n    }\n\n    if (!item) {\n      item = offsets.pop();\n      item.offset += item.matchedLine.length;\n    }\n\n    if (alreadyIncluded) {\n      console.log(`Rule name is already present in ${checkName}.`);\n    } else {\n      readme = readme.slice(0, item.offset) +\n                (item.offset ? '\\n' : '') +\n                newLine +\n                (item.offset ? '' : '\\n') +\n                readme.slice(item.offset);\n\n      await fs.writeFile(path, readme);\n    }\n  };\n\n  await replaceInOrder({\n    checkName: 'README',\n    newLine: `{\"gitdown\": \"include\", \"file\": \"./rules/${ruleName}.md\"}`,\n    oldRegex: /\\n\\{\"gitdown\": \"include\", \"file\": \".\\/rules\\/(?<oldRule>[^.]*).md\"\\}/gu,\n    path: './.README/README.md',\n  });\n\n  await replaceInOrder({\n    checkName: 'index import',\n    newLine: `import ${camelCasedRuleName} from './rules/${camelCasedRuleName}';`,\n    oldIsCamel: true,\n    oldRegex: /\\nimport (?<oldRule>[^ ]*) from '.\\/rules\\/\\1';/gu,\n    path: './src/index.js',\n  });\n\n  await replaceInOrder({\n    checkName: 'index recommended',\n    newLine: `${' '.repeat(8)}'jsdoc/${ruleName}': '${recommended ? 'warn' : 'off'}',`,\n    oldRegex: /\\n\\s{8}'jsdoc\\/(?<oldRule>[^']*)': '[^']*',/gu,\n    path: './src/index.js',\n  });\n\n  await replaceInOrder({\n    checkName: 'index rules',\n    newLine: `${' '.repeat(4)}'${ruleName}': ${camelCasedRuleName},`,\n    oldRegex: /\\n\\s{4}'(?<oldRule>[^']*)': [^,]*,/gu,\n    path: './src/index.js',\n  });\n\n  await import('./generateReadme.js');\n\n  /*\n  console.log('Paths to open for further editing\\n');\n  console.log(`open ${ruleReadmePath}`);\n  console.log(`open ${rulePath}`);\n  console.log(`open ${ruleTestPath}\\n`);\n  */\n\n  // Set chdir as somehow still in operation from other test\n  process.chdir(resolve(__dirname, '../../'));\n  await open([\n    // Could even add editor line column numbers like `${rulePath}:1:1`\n    ruleReadmePath,\n    ruleTestPath,\n    rulePath,\n  ]);\n})();\n"],"mappings":"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"}