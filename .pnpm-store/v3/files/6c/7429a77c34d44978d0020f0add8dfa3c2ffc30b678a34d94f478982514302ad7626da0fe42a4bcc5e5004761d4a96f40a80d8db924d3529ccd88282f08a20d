{"version":3,"file":"matchDescription.js","names":["matchDescriptionDefault","stringOrDefault","value","userDefault","iterateJsdoc","jsdoc","report","context","utils","mainDescription","matchDescription","message","tags","options","validateDescription","desc","tag","mainDescriptionMatch","errorMessage","match","Object","prototype","hasOwnProperty","call","tagValue","tagName","regex","getRegexFromString","test","line","source","number","description","getDescription","keys","length","hasOptionTag","Boolean","forEachPreferredTag","matchingJsdocTag","targetTagName","name","getTagDescription","trim","whitelistedTags","filterTags","tagsWithNames","tagsWithoutNames","getTagsByType","some","replace","contextDefaults","meta","docs","url","schema","additionalProperties","properties","contexts","items","anyOf","type","comment","oneOf","format","patternProperties","enum"],"sources":["../../src/rules/matchDescription.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc';\n\n// If supporting Node >= 10, we could loosen the default to this for the\n//   initial letter: \\\\p{Upper}\nconst matchDescriptionDefault = '^\\n?([A-Z`\\\\d_][\\\\s\\\\S]*[.?!`]\\\\s*)?$';\n\nconst stringOrDefault = (value, userDefault) => {\n  return typeof value === 'string' ?\n    value :\n    userDefault || matchDescriptionDefault;\n};\n\nexport default iterateJsdoc(({\n  jsdoc,\n  report,\n  context,\n  utils,\n}) => {\n  const {\n    mainDescription,\n    matchDescription,\n    message,\n    tags,\n  } = context.options[0] || {};\n\n  const validateDescription = (desc, tag) => {\n    let mainDescriptionMatch = mainDescription;\n    let errorMessage = message;\n    if (typeof mainDescription === 'object') {\n      mainDescriptionMatch = mainDescription.match;\n      errorMessage = mainDescription.message;\n    }\n\n    if (mainDescriptionMatch === false && (\n      !tag || !Object.prototype.hasOwnProperty.call(tags, tag.tag))\n    ) {\n      return;\n    }\n\n    let tagValue = mainDescriptionMatch;\n    if (tag) {\n      const tagName = tag.tag;\n      if (typeof tags[tagName] === 'object') {\n        tagValue = tags[tagName].match;\n        errorMessage = tags[tagName].message;\n      } else {\n        tagValue = tags[tagName];\n      }\n    }\n\n    const regex = utils.getRegexFromString(\n      stringOrDefault(tagValue, matchDescription),\n    );\n\n    if (!regex.test(desc)) {\n      report(\n        errorMessage || 'JSDoc description does not satisfy the regex pattern.',\n        null,\n        tag || {\n          // Add one as description would typically be into block\n          line: jsdoc.source[0].number + 1,\n        },\n      );\n    }\n  };\n\n  const {\n    description,\n  } = utils.getDescription();\n  if (description) {\n    validateDescription(description);\n  }\n\n  if (!tags || !Object.keys(tags).length) {\n    return;\n  }\n\n  const hasOptionTag = (tagName) => {\n    return Boolean(tags[tagName]);\n  };\n\n  utils.forEachPreferredTag('description', (matchingJsdocTag, targetTagName) => {\n    const desc = (matchingJsdocTag.name + ' ' + utils.getTagDescription(matchingJsdocTag)).trim();\n    if (hasOptionTag(targetTagName)) {\n      validateDescription(desc, matchingJsdocTag);\n    }\n  }, true);\n\n  const whitelistedTags = utils.filterTags(({\n    tag: tagName,\n  }) => {\n    return hasOptionTag(tagName);\n  });\n  const {\n    tagsWithNames,\n    tagsWithoutNames,\n  } = utils.getTagsByType(whitelistedTags);\n\n  tagsWithNames.some((tag) => {\n    const desc = utils.getTagDescription(tag).replace(/^[- ]*/u, '')\n      .trim();\n\n    return validateDescription(desc, tag);\n  });\n\n  tagsWithoutNames.some((tag) => {\n    const desc = (tag.name + ' ' + utils.getTagDescription(tag)).trim();\n\n    return validateDescription(desc, tag);\n  });\n}, {\n  contextDefaults: true,\n  meta: {\n    docs: {\n      description: 'Enforces a regular expression pattern on descriptions.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-match-description',\n    },\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          contexts: {\n            items: {\n              anyOf: [\n                {\n                  type: 'string',\n                },\n                {\n                  additionalProperties: false,\n                  properties: {\n                    comment: {\n                      type: 'string',\n                    },\n                    context: {\n                      type: 'string',\n                    },\n                  },\n                  type: 'object',\n                },\n              ],\n            },\n            type: 'array',\n          },\n          mainDescription: {\n            oneOf: [\n              {\n                format: 'regex',\n                type: 'string',\n              },\n              {\n                type: 'boolean',\n              },\n              {\n                additionalProperties: false,\n                properties: {\n                  match: {\n                    oneOf: [\n                      {\n                        format: 'regex',\n                        type: 'string',\n                      },\n                      {\n                        type: 'boolean',\n                      },\n                    ],\n                  },\n                  message: {\n                    type: 'string',\n                  },\n                },\n                type: 'object',\n              },\n            ],\n          },\n          matchDescription: {\n            format: 'regex',\n            type: 'string',\n          },\n          message: {\n            type: 'string',\n          },\n          tags: {\n            patternProperties: {\n              '.*': {\n                oneOf: [\n                  {\n                    format: 'regex',\n                    type: 'string',\n                  },\n                  {\n                    enum: [\n                      true,\n                    ],\n                    type: 'boolean',\n                  },\n                  {\n                    additionalProperties: false,\n                    properties: {\n                      match: {\n                        oneOf: [\n                          {\n                            format: 'regex',\n                            type: 'string',\n                          },\n                          {\n                            enum: [\n                              true,\n                            ],\n                            type: 'boolean',\n                          },\n                        ],\n                      },\n                      message: {\n                        type: 'string',\n                      },\n                    },\n                    type: 'object',\n                  },\n                ],\n              },\n            },\n            type: 'object',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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"}