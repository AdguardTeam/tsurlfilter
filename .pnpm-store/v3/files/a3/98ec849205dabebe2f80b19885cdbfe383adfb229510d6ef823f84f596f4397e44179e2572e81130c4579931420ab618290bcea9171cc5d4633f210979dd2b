{"version":3,"file":"checkPropertyNames.js","names":["validatePropertyNames","targetTagName","enableFixer","jsdoc","utils","propertyTags","Object","entries","tags","filter","tag","some","index","tagsIndex","dupeTagInfo","find","tgsIndex","tg","idx","name","reportJSDoc","removeTag","validatePropertyNamesDeep","jsdocPropertyNames","report","lastRealProperty","jsdocPropertyName","isPropertyPath","includes","pathRootNodeName","slice","indexOf","endsWith","iterateJsdoc","context","options","jsdocPropertyNamesDeep","getJsdocTagsDeep","length","getPreferredTagName","tagName","isError","iterateAllJsdocs","meta","docs","description","url","fixable","schema","additionalProperties","properties","type"],"sources":["../../src/rules/checkPropertyNames.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc';\n\n/**\n * @param {string} targetTagName\n * @param {boolean} enableFixer\n * @param jsdoc\n * @param utils\n * @returns {boolean}\n */\nconst validatePropertyNames = (\n  targetTagName,\n  enableFixer,\n  jsdoc, utils,\n) => {\n  const propertyTags = Object.entries(jsdoc.tags).filter(([\n    , tag,\n  ]) => {\n    return tag.tag === targetTagName;\n  });\n\n  return propertyTags.some(([\n    , tag,\n  ], index) => {\n    let tagsIndex;\n    const dupeTagInfo = propertyTags.find(([\n      tgsIndex,\n      tg,\n    ], idx) => {\n      tagsIndex = tgsIndex;\n\n      return tg.name === tag.name && idx !== index;\n    });\n    if (dupeTagInfo) {\n      utils.reportJSDoc(`Duplicate @${targetTagName} \"${tag.name}\"`, dupeTagInfo[1], enableFixer ? () => {\n        utils.removeTag(tagsIndex);\n      } : null);\n\n      return true;\n    }\n\n    return false;\n  });\n};\n\n/**\n * @param {string} targetTagName\n * @param {string[]} jsdocPropertyNames\n * @param jsdoc\n * @param {Function} report\n */\nconst validatePropertyNamesDeep = (\n  targetTagName,\n  jsdocPropertyNames, jsdoc, report,\n) => {\n  let lastRealProperty;\n\n  return jsdocPropertyNames.some(({\n    name: jsdocPropertyName,\n    idx,\n  }) => {\n    const isPropertyPath = jsdocPropertyName.includes('.');\n\n    if (isPropertyPath) {\n      if (!lastRealProperty) {\n        report(`@${targetTagName} path declaration (\"${jsdocPropertyName}\") appears before any real property.`, null, jsdoc.tags[idx]);\n\n        return true;\n      }\n\n      let pathRootNodeName = jsdocPropertyName.slice(0, jsdocPropertyName.indexOf('.'));\n\n      if (pathRootNodeName.endsWith('[]')) {\n        pathRootNodeName = pathRootNodeName.slice(0, -2);\n      }\n\n      if (pathRootNodeName !== lastRealProperty) {\n        report(\n          `@${targetTagName} path declaration (\"${jsdocPropertyName}\") root node name (\"${pathRootNodeName}\") ` +\n          `does not match previous real property name (\"${lastRealProperty}\").`,\n          null,\n          jsdoc.tags[idx],\n        );\n\n        return true;\n      }\n    } else {\n      lastRealProperty = jsdocPropertyName;\n    }\n\n    return false;\n  });\n};\n\nexport default iterateJsdoc(({\n  context,\n  jsdoc,\n  report,\n  utils,\n}) => {\n  const {\n    enableFixer = false,\n  } = context.options[0] || {};\n  const jsdocPropertyNamesDeep = utils.getJsdocTagsDeep('property');\n  if (!jsdocPropertyNamesDeep.length) {\n    return;\n  }\n\n  const targetTagName = utils.getPreferredTagName({\n    tagName: 'property',\n  });\n  const isError = validatePropertyNames(\n    targetTagName,\n    enableFixer,\n    jsdoc,\n    utils,\n  );\n\n  if (isError) {\n    return;\n  }\n\n  validatePropertyNamesDeep(\n    targetTagName, jsdocPropertyNamesDeep, jsdoc, report,\n  );\n}, {\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: 'Ensures that property names in JSDoc are not duplicated on the same block and that nested properties have defined roots.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-check-property-names',\n    },\n    fixable: 'code',\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          enableFixer: {\n            type: 'boolean',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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"}