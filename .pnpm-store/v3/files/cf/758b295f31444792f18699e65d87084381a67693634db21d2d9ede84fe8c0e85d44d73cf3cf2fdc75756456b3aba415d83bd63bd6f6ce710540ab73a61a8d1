{"version":3,"file":"requireFileOverview.js","names":["defaultTags","file","initialCommentsOnly","mustExist","preventDuplicates","setDefaults","state","globalTags","hasDuplicates","hasTag","hasNonCommentBeforeTag","iterateJsdoc","jsdocNode","utils","context","tags","options","tagName","Object","keys","targetTagName","getPreferredTagName","hasDuplicate","hasNonComment","range","exit","entries","obj","getPreferredTagNameObject","blocked","reportSettings","replacement","iterateAllJsdocs","meta","docs","description","url","schema","additionalProperties","properties","patternProperties","type","nonComment","node"],"sources":["../../src/rules/requireFileOverview.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc';\n\nconst defaultTags = {\n  file: {\n    initialCommentsOnly: true,\n    mustExist: true,\n    preventDuplicates: true,\n  },\n};\n\nconst setDefaults = (state) => {\n  // First iteration\n  if (!state.globalTags) {\n    state.globalTags = {};\n    state.hasDuplicates = {};\n    state.hasTag = {};\n    state.hasNonCommentBeforeTag = {};\n  }\n};\n\nexport default iterateJsdoc(({\n  jsdocNode,\n  state,\n  utils,\n  context,\n}) => {\n  const {\n    tags = defaultTags,\n  } = context.options[0] || {};\n\n  setDefaults(state);\n\n  for (const tagName of Object.keys(tags)) {\n    const targetTagName = utils.getPreferredTagName({\n      tagName,\n    });\n\n    const hasTag = targetTagName && utils.hasTag(targetTagName);\n\n    state.hasTag[tagName] = hasTag || state.hasTag[tagName];\n\n    const hasDuplicate = state.hasDuplicates[tagName];\n\n    if (hasDuplicate === false) {\n      // Was marked before, so if a tag now, is a dupe\n      state.hasDuplicates[tagName] = hasTag;\n    } else if (!hasDuplicate && hasTag) {\n      // No dupes set before, but has first tag, so change state\n      //   from `undefined` to `false` so can detect next time\n      state.hasDuplicates[tagName] = false;\n      state.hasNonCommentBeforeTag[tagName] = state.hasNonComment &&\n        state.hasNonComment < jsdocNode.range[0];\n    }\n  }\n}, {\n  exit ({\n    context,\n    state,\n    utils,\n  }) {\n    setDefaults(state);\n    const {\n      tags = defaultTags,\n    } = context.options[0] || {};\n\n    for (const [\n      tagName,\n      {\n        mustExist = false,\n        preventDuplicates = false,\n        initialCommentsOnly = false,\n      },\n    ] of Object.entries(tags)) {\n      const obj = utils.getPreferredTagNameObject({\n        tagName,\n      });\n      if (obj && obj.blocked) {\n        utils.reportSettings(\n          `\\`settings.jsdoc.tagNamePreference\\` cannot block @${obj.tagName} ` +\n          'for the `require-file-overview` rule',\n        );\n      } else {\n        const targetTagName = obj && obj.replacement || obj;\n        if (mustExist && !state.hasTag[tagName]) {\n          utils.reportSettings(`Missing @${targetTagName}`);\n        }\n\n        if (preventDuplicates && state.hasDuplicates[tagName]) {\n          utils.reportSettings(\n            `Duplicate @${targetTagName}`,\n          );\n        }\n\n        if (initialCommentsOnly &&\n            state.hasNonCommentBeforeTag[tagName]\n        ) {\n          utils.reportSettings(\n            `@${targetTagName} should be at the beginning of the file`,\n          );\n        }\n      }\n    }\n  },\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: 'Checks that all files have one `@file`, `@fileoverview`, or `@overview` tag at the beginning of the file.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-require-file-overview',\n    },\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          tags: {\n            patternProperties: {\n              '.*': {\n                additionalProperties: false,\n                properties: {\n                  initialCommentsOnly: {\n                    type: 'boolean',\n                  },\n                  mustExist: {\n                    type: 'boolean',\n                  },\n                  preventDuplicates: {\n                    type: 'boolean',\n                  },\n                },\n                type: 'object',\n              },\n            },\n            type: 'object',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n  nonComment ({\n    state,\n    node,\n  }) {\n    if (!state.hasNonComment) {\n      state.hasNonComment = node.range[0];\n    }\n  },\n});\n"],"mappings":"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"}