{"version":3,"file":"sortTags.js","names":["iterateJsdoc","context","jsdoc","utils","tagSequence","defaultTagOrder","alphabetizeExtras","options","otherPos","indexOf","endPos","length","ongoingCount","idx","tag","tags","entries","originalIndex","source","originalLine","firstChangedTagLine","firstChangedTagIndex","sortedTags","JSON","parse","stringify","sort","tagNew","tagOld","checkOrSetFirstChanged","newPos","oldPos","preferredNewPos","preferredOldPos","undefined","firstLine","getFirstLine","fix","itemsToMoveRange","Array","from","keys","unchangedPriorTagDescriptions","slice","reduce","ct","initialOffset","removeTag","changedTags","extraTagCount","changedTag","addTag","tokens","end","addLine","reportJSDoc","join","iterateAllJsdocs","meta","docs","description","url","fixable","schema","additionalProperies","properties","type","items"],"sources":["../../src/rules/sortTags.js"],"sourcesContent":["import defaultTagOrder from '../defaultTagOrder';\nimport iterateJsdoc from '../iterateJsdoc';\n\nexport default iterateJsdoc(({\n  context,\n  jsdoc,\n  utils,\n}) => {\n  const {\n    tagSequence = defaultTagOrder,\n    alphabetizeExtras = false,\n  } = context.options[0] || {};\n\n  const otherPos = tagSequence.indexOf('-other');\n  const endPos = otherPos > -1 ? otherPos : tagSequence.length;\n\n  let ongoingCount = 0;\n  for (const [\n    idx,\n    tag,\n  ] of jsdoc.tags.entries()) {\n    tag.originalIndex = idx;\n    ongoingCount += tag.source.length;\n    tag.originalLine = ongoingCount;\n  }\n\n  let firstChangedTagLine;\n  let firstChangedTagIndex;\n  const sortedTags = JSON.parse(JSON.stringify(jsdoc.tags));\n  sortedTags.sort(({\n    tag: tagNew,\n  }, {\n    originalIndex,\n    originalLine,\n    tag: tagOld,\n  }) => {\n    // Optimize: Just keep relative positions if the same tag name\n    if (tagNew === tagOld) {\n      return 0;\n    }\n\n    const checkOrSetFirstChanged = () => {\n      if (!firstChangedTagLine || originalLine < firstChangedTagLine) {\n        firstChangedTagLine = originalLine;\n        firstChangedTagIndex = originalIndex;\n      }\n    };\n\n    const newPos = tagSequence.indexOf(tagNew);\n    const oldPos = tagSequence.indexOf(tagOld);\n\n    const preferredNewPos = newPos === -1 ? endPos : newPos;\n    const preferredOldPos = oldPos === -1 ? endPos : oldPos;\n\n    if (preferredNewPos < preferredOldPos) {\n      checkOrSetFirstChanged();\n      return -1;\n    }\n\n    if (preferredNewPos > preferredOldPos) {\n      return 1;\n    }\n\n    // preferredNewPos === preferredOldPos\n    if (\n      !alphabetizeExtras ||\n\n      // Optimize: If tagNew (or tagOld which is the same) was found in the\n      //   priority array, it can maintain its relative positionâ€”without need\n      //   of alphabetizing (secondary sorting)\n      newPos >= 0\n    ) {\n      return 0;\n    }\n\n    if (tagNew < tagOld) {\n      checkOrSetFirstChanged();\n      return -1;\n    }\n\n    // tagNew > tagOld\n    return 1;\n  });\n\n  if (firstChangedTagLine === undefined) {\n    return;\n  }\n\n  const firstLine = utils.getFirstLine();\n\n  const fix = () => {\n    const itemsToMoveRange = [\n      ...Array.from({\n        length: jsdoc.tags.length - firstChangedTagIndex,\n      }).keys(),\n    ];\n\n    const unchangedPriorTagDescriptions = jsdoc.tags.slice(\n      0,\n      firstChangedTagIndex,\n    ).reduce((ct, {\n      source,\n    }) => {\n      return ct + source.length - 1;\n    }, 0);\n\n    // This offset includes not only the offset from where the first tag\n    //   must begin, and the additional offset of where the first changed\n    //   tag begins, but it must also account for prior descriptions\n    const initialOffset = firstLine + firstChangedTagIndex +\n\n      // May be the first tag, so don't try finding a prior one if so\n      unchangedPriorTagDescriptions;\n\n    // Use `firstChangedTagLine` for line number to begin reporting/splicing\n    for (const idx of itemsToMoveRange) {\n      utils.removeTag(idx + firstChangedTagIndex);\n    }\n\n    const changedTags = sortedTags.slice(firstChangedTagIndex);\n    let extraTagCount = 0;\n\n    for (const idx of itemsToMoveRange) {\n      const changedTag = changedTags[idx];\n\n      utils.addTag(\n        changedTag.tag,\n        extraTagCount + initialOffset + idx,\n        {\n          ...changedTag.source[0].tokens,\n\n          // `comment-parser` puts the `end` within the `tags` section, so\n          //   avoid adding another to jsdoc.source\n          end: '',\n        },\n      );\n\n      for (const {\n        tokens,\n      } of changedTag.source.slice(1)) {\n        if (!tokens.end) {\n          utils.addLine(\n            extraTagCount + initialOffset + idx + 1,\n            {\n              ...tokens,\n              end: '',\n            },\n          );\n          extraTagCount++;\n        }\n      }\n    }\n  };\n\n  utils.reportJSDoc(\n    `Tags are not in the prescribed order: ${tagSequence.join(', ')}`,\n    jsdoc.tags[firstChangedTagIndex],\n    fix,\n    true,\n  );\n}, {\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: '',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-sort-tags',\n    },\n    fixable: 'code',\n    schema: [\n      {\n        additionalProperies: false,\n        properties: {\n          alphabetizeExtras: {\n            type: 'boolean',\n          },\n          tagSequence: {\n            items: {\n              type: 'string',\n            },\n            type: 'array',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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"}