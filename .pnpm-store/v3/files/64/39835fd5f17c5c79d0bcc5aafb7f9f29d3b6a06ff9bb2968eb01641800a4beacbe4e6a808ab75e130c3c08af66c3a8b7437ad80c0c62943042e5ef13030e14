{"version":3,"file":"requireYields.js","names":["canSkip","utils","hasATag","avoidDocs","checkTagName","report","tagName","preferredTagName","getPreferredTagName","tags","getTags","length","tag","missingTag","iterateJsdoc","context","next","nextWithGeneratorTag","forceRequireNext","forceRequireYields","withGeneratorTag","options","iteratingFunction","isIteratingFunction","preferredYieldTagName","missingYieldTag","shouldReportYields","hasTag","isGenerator","hasYieldValue","preferredNextTagName","missingNextTag","shouldReportNext","hasYieldReturnValue","contextDefaults","meta","docs","description","url","schema","additionalProperties","properties","contexts","items","anyOf","type","comment","exemptedBy","default"],"sources":["../../src/rules/requireYields.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc';\n\n/**\n * We can skip checking for a yield value, in case the documentation is inherited\n * or the method has a constructor or abstract tag.\n *\n * In either of these cases the yield value is optional or not defined.\n *\n * @param {*} utils a reference to the utils which are used to probe if a tag is present or not.\n * @returns {boolean} true in case deep checking can be skipped; otherwise false.\n */\nconst canSkip = (utils) => {\n  return utils.hasATag([\n    // inheritdoc implies that all documentation is inherited\n    // see https://jsdoc.app/tags-inheritdoc.html\n    //\n    // Abstract methods are by definition incomplete,\n    // so it is not an error if it declares a yield value but does not implement it.\n    'abstract',\n    'virtual',\n\n    // Constructors do not have a yield value\n    // so we can bail out here, too.\n    'class',\n    'constructor',\n\n    // Yield (and any `next`) type is specified accompanying the targeted\n    //   @type\n    'type',\n\n    // This seems to imply a class as well\n    'interface',\n  ]) ||\n    utils.avoidDocs();\n};\n\nconst checkTagName = (utils, report, tagName) => {\n  const preferredTagName = utils.getPreferredTagName({\n    tagName,\n  });\n  if (!preferredTagName) {\n    return [];\n  }\n\n  const tags = utils.getTags(preferredTagName);\n\n  if (tags.length > 1) {\n    report(`Found more than one @${preferredTagName} declaration.`);\n  }\n\n  // In case the code yields something, we expect a yields value in JSDoc.\n  const [\n    tag,\n  ] = tags;\n  const missingTag = typeof tag === 'undefined' || tag === null;\n\n  return [\n    preferredTagName, missingTag,\n  ];\n};\n\nexport default iterateJsdoc(({\n  report,\n  utils,\n  context,\n}) => {\n  const {\n    next = false,\n    nextWithGeneratorTag = false,\n    forceRequireNext = false,\n    forceRequireYields = false,\n    withGeneratorTag = true,\n  } = context.options[0] || {};\n\n  // A preflight check. We do not need to run a deep check\n  // in case the @yield comment is optional or undefined.\n  if (canSkip(utils)) {\n    return;\n  }\n\n  const iteratingFunction = utils.isIteratingFunction();\n\n  const [\n    preferredYieldTagName,\n    missingYieldTag,\n  ] = checkTagName(\n    utils, report, 'yields',\n  );\n  if (preferredYieldTagName) {\n    const shouldReportYields = () => {\n      if (!missingYieldTag) {\n        return false;\n      }\n\n      if (\n        withGeneratorTag && utils.hasTag('generator') ||\n        forceRequireYields && iteratingFunction && utils.isGenerator()\n      ) {\n        return true;\n      }\n\n      return iteratingFunction && utils.isGenerator() && utils.hasYieldValue();\n    };\n\n    if (shouldReportYields()) {\n      report(`Missing JSDoc @${preferredYieldTagName} declaration.`);\n    }\n  }\n\n  if (next || nextWithGeneratorTag || forceRequireNext) {\n    const [\n      preferredNextTagName,\n      missingNextTag,\n    ] = checkTagName(\n      utils, report, 'next',\n    );\n    if (!preferredNextTagName) {\n      return;\n    }\n\n    const shouldReportNext = () => {\n      if (!missingNextTag) {\n        return false;\n      }\n\n      if (\n        nextWithGeneratorTag && utils.hasTag('generator')) {\n        return true;\n      }\n\n      if (\n        !next && !forceRequireNext ||\n        !iteratingFunction ||\n        !utils.isGenerator()\n      ) {\n        return false;\n      }\n\n      return forceRequireNext || utils.hasYieldReturnValue();\n    };\n\n    if (shouldReportNext()) {\n      report(`Missing JSDoc @${preferredNextTagName} declaration.`);\n    }\n  }\n}, {\n  contextDefaults: true,\n  meta: {\n    docs: {\n      description: 'Requires yields are documented.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-require-yields',\n    },\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          contexts: {\n            items: {\n              anyOf: [\n                {\n                  type: 'string',\n                },\n                {\n                  additionalProperties: false,\n                  properties: {\n                    comment: {\n                      type: 'string',\n                    },\n                    context: {\n                      type: 'string',\n                    },\n                  },\n                  type: 'object',\n                },\n              ],\n            },\n            type: 'array',\n          },\n          exemptedBy: {\n            items: {\n              type: 'string',\n            },\n            type: 'array',\n          },\n          forceRequireNext: {\n            default: false,\n            type: 'boolean',\n          },\n          forceRequireYields: {\n            default: false,\n            type: 'boolean',\n          },\n          next: {\n            default: false,\n            type: 'boolean',\n          },\n          nextWithGeneratorTag: {\n            default: false,\n            type: 'boolean',\n          },\n          withGeneratorTag: {\n            default: true,\n            type: 'boolean',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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"}