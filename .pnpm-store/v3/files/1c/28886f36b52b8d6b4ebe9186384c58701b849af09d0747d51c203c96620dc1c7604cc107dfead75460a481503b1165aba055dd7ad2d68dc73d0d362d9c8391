{"version":3,"file":"tagLines.js","names":["iterateJsdoc","context","jsdoc","utils","alwaysNever","count","dropEndLines","noEndLines","tags","options","some","tg","tagIdx","lastTag","lastEmpty","reportIndex","idx","tokens","tag","name","type","description","end","source","entries","includes","slice","lines","empty","length","fixer","removeTagItem","reportJSDoc","line","number","currentTag","tagSourceIdx","splice","push","currentTg","tagCount","defaultAlways","overrideAlways","fixCount","addLines","iterateAllJsdocs","meta","docs","url","fixable","schema","enum","additionalProperies","properties","patternProperties","additionalProperties"],"sources":["../../src/rules/tagLines.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc';\n\nexport default iterateJsdoc(({\n  context,\n  jsdoc,\n  utils,\n}) => {\n  const [\n    alwaysNever = 'never',\n    {\n      count = 1,\n      dropEndLines = false,\n      noEndLines = false,\n      tags = {},\n    } = {},\n  ] = context.options;\n\n  jsdoc.tags.some((tg, tagIdx) => {\n    let lastTag;\n    let lastEmpty = null;\n\n    let reportIndex = null;\n    for (const [\n      idx,\n      {\n        tokens: {\n          tag,\n          name,\n          type,\n          description,\n          end,\n        },\n      },\n    ] of tg.source.entries()) {\n      // May be text after a line break within a tag description\n      if (description) {\n        reportIndex = null;\n      }\n\n      if (lastTag && [\n        'any', 'always',\n      ].includes(tags[lastTag.slice(1)]?.lines)) {\n        continue;\n      }\n\n      const empty = !tag && !name && !type && !description;\n      if (\n        empty && !end &&\n        (alwaysNever === 'never' ||\n          lastTag && tags[lastTag.slice(1)]?.lines === 'never'\n        )\n      ) {\n        reportIndex = idx;\n\n        continue;\n      }\n\n      if (!end) {\n        lastEmpty = empty ? idx : null;\n      }\n\n      lastTag = tag;\n    }\n\n    if (dropEndLines && lastEmpty !== null && tagIdx === jsdoc.tags.length - 1) {\n      const fixer = () => {\n        utils.removeTagItem(tagIdx, lastEmpty);\n      };\n\n      utils.reportJSDoc(\n        'Expected no trailing lines',\n        {\n          line: tg.source[lastEmpty].number,\n        },\n        fixer,\n      );\n\n      return true;\n    }\n\n    if (reportIndex !== null) {\n      const fixer = () => {\n        utils.removeTagItem(tagIdx, reportIndex);\n      };\n\n      utils.reportJSDoc(\n        'Expected no lines between tags',\n        {\n          line: tg.source[0].number + 1,\n        },\n        fixer,\n      );\n\n      return true;\n    }\n\n    return false;\n  });\n\n  (noEndLines ? jsdoc.tags.slice(0, -1) : jsdoc.tags).some((tg, tagIdx) => {\n    const lines = [];\n\n    let currentTag;\n    let tagSourceIdx = 0;\n    for (const [\n      idx,\n      {\n        number,\n        tokens: {\n          tag,\n          name,\n          type,\n          description,\n          end,\n        },\n      },\n    ] of tg.source.entries()) {\n      if (description) {\n        lines.splice(0, lines.length);\n        tagSourceIdx = idx;\n      }\n\n      if (tag) {\n        currentTag = tag;\n      }\n\n      if (!tag && !name && !type && !description && !end) {\n        lines.push({\n          idx,\n          number,\n        });\n      }\n    }\n\n    const currentTg = currentTag && tags[currentTag.slice(1)];\n    const tagCount = currentTg?.count;\n\n    const defaultAlways = alwaysNever === 'always' && currentTg?.lines !== 'never' &&\n      currentTg?.lines !== 'any' && lines.length < count;\n\n    let overrideAlways;\n    let fixCount = count;\n    if (!defaultAlways) {\n      fixCount = typeof tagCount === 'number' ? tagCount : count;\n      overrideAlways = currentTg?.lines === 'always' &&\n        lines.length < fixCount;\n    }\n\n    if (defaultAlways || overrideAlways) {\n      const fixer = () => {\n        utils.addLines(tagIdx, lines[lines.length - 1]?.idx || tagSourceIdx + 1, fixCount - lines.length);\n      };\n\n      const line = lines[lines.length - 1]?.number || tg.source[tagSourceIdx].number;\n      utils.reportJSDoc(\n        `Expected ${fixCount} line${fixCount === 1 ? '' : 's'} between tags but found ${lines.length}`,\n        {\n          line,\n        },\n        fixer,\n      );\n\n      return true;\n    }\n\n    return false;\n  });\n}, {\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: 'Enforces lines (or no lines) between tags.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-tag-lines',\n    },\n    fixable: 'code',\n    schema: [\n      {\n        enum: [\n          'always', 'any', 'never',\n        ],\n        type: 'string',\n      },\n      {\n        additionalProperies: false,\n        properties: {\n          count: {\n            type: 'integer',\n          },\n          dropEndLines: {\n            type: 'boolean',\n          },\n          noEndLines: {\n            type: 'boolean',\n          },\n          tags: {\n            patternProperties: {\n              '.*': {\n                additionalProperties: false,\n                properties: {\n                  count: {\n                    type: 'integer',\n                  },\n                  lines: {\n                    enum: [\n                      'always', 'never', 'any',\n                    ],\n                    type: 'string',\n                  },\n                },\n              },\n            },\n            type: 'object',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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"}